---
title: 流程编排那些事
author: daviswujiahao
date: 2023-06-06 11:33:00 +0800
categories: [技术]
tags: [流程编排,开源调研]
math: true
mermaid: true
---

[TOC]

# 背景介绍

## 何为编排

在计算机科学和软件工程中，"编排"（Orchestration）是指协调和管理多个独立组件或服务，以实现特定的业务流程或工作流程。它涉及到在一个整体系统中将各个组件或服务按照预定的顺序和方式进行调度、执行和交互。编排通常用于构建分布式系统、集成不同的服务或微服务，并实现复杂的业务逻辑和流程。编排的目标是通过协调和组织各个组件或服务之间的交互，以实现特定的功能和业务需求。
编排可以涉及以下几个方面：

1. 流程定义：编排定义了业务流程或工作流程的步骤、顺序和条件。它描述了系统中各个组件或服务之间的依赖关系和交互方式。
2. 调度和协调：编排负责根据流程定义，调度和协调各个组件或服务的执行。它确保在正确的时间和顺序下启动和运行每个组件，以满足整体流程的要求。
3. 数据传递和转换：编排负责管理数据在各个组件或服务之间的传递和转换。它确保正确的数据被传递给需要的组件，并处理数据格式转换和映射等。
4. 错误处理和故障恢复：编排需要处理可能发生的错误和故障情况。它可以包括错误处理、重试机制、故障恢复策略等，以确保整个流程的可靠性和稳定性。
编排可以使用不同的工具和技术来实现，例如工作流引擎、编排引擎、容器编排平台等。这些工具提供了一种便捷的方式来定义、执行和管理复杂的业务流程或工作流程。
总之，编排是一种在分布式系统或微服务架构中协调和管理多个组件或服务的方式，以实现特定的业务逻辑和流程。它涉及到定义流程、调度执行、数据传递、错误处理等任务，以实现系统的整体功能和要求。

## 编制(Orchestration)VS编排(Choreography)

编制的英文是 Orchestration，本意是乐队指挥，在演出的时候，乐队由指挥来统一的进行指挥和控制。
编排的英文是 Choreography，本意是舞蹈编舞，舞蹈表演通常是舞蹈演员对外部感应作出响应，比如音乐的响应，并且需要与舞伴的行动和表情进行配合。
单从字面看 Orchestration为管弦乐曲，由一人负责指挥与调控各个乐师，而Choreography为舞蹈，各个舞蹈者多为对等关系，没有统一的协调者。事实上也是如此，Orchestration需要类似ESB的服务总线来统一管理调度各个服务间的通讯，而Choreography更强调的是各服务自治，各自自己去调用需要的服务，相对而言更去中心化。

![编制(Orchestration)VS编排(Choreography)](https://ask.qcloudimg.com/http-save/yehe-1475574/g10voqcq7r.jpeg)

微服务的编制强调的是通过一个可执行的中心流程来协同内部及外部的服务交互。通过中心流程来控制总体的目标，涉及的操作，服务调用顺序。
微服务的编排强调的是协作，通过消息的交互序列来控制各个部分资源的交互。参与交互的资源都是对等的，没有集中的控制。
编制（Orchestration）就好像交通信号灯，控制着车辆什么时候可以通行。而编排（Choreography）就好像是环岛，没有集中的控制，只有一系列的规则来指明车辆在接近十字路口的时候必须要等待，直到有空间进入环岛环绕系统，然后寻找适当的时候离开。
![编制(Orchestration)VS编排(Choreography)](https://ask.qcloudimg.com/http-save/yehe-1475574/stru92o58o.jpeg)

Orchestration是有中心化调度服务以协调各组件通信的方式，以用户注册流程为例：
![用户注册流程编制](https://raw.githubusercontent.com/gudaoxuri/Microservices-Architecture/master/resources/images/ms-services-invoke-register-orchestration.png)
各服务间都通过ESB进行数据通信，用户注册后会向ESB发送调用活动服务的用户注册接口，ESB会将对应的请求路由给活动服务，活动服务收到请求并处理后又向ESB发送调用卡券服务生成卡券，调用积分服务生成积分，ESB路由此请求给卡券服务和积分服务。我们可以在ESB中做集中式的权限管控、日志处理等增强操作，这是它很大的优势，但也带来了不少的问题，存在中心化的ESB，所有请求都要经由ESB，所以在性能、扩展性、灵活性上会比较差。

Choreography则是去中心化的、点对点的通信的方式，还是以注册为例：
![用户注册流程编排](https://raw.githubusercontent.com/gudaoxuri/Microservices-Architecture/master/resources/images/ms-services-invoke-register-choreography.png)
所有的请求都是直接调用对应的服务，没有ESB，这带来的直接好处是性能的提升，但是存在一定的服务耦合，比如用户服务就需要感知到卡券服务及活动服务，活动服务需要感知到卡券服务，但是这点其实**可以通过事件驱动架构来优化**。

当然，**刻意的区分 “编制” 与 “编排” 并没有多大价值**，**重要的是保证各参与方对所用的术语有共同的理解**，业内也并未普遍区分“编制” 与 “编排”的区别，并以编排来泛指了“编制” 与 “编排”这两种流程设计模式，故本文中后续内容的编排采用业内普遍看法，代指为“编制” 与 “编排”。

## 长流程VS短流程

流程有长流程和短流程之分:

- 长流程是指包含人工活动的流程，流程的完成时间因为人的因素会在一个较大范围内波动；
- 短流程指的是不包含人工活动的流程，在流程启动后会在一个较短的预期时间内完成。
  
**本文介绍的流程编排主要是短流程相关的编排**。
